import{r as e,j as r}from"./D-s6PRqiKBLBeb70.js";import{c as s,b as t}from"./BfZ2chxSRdnyRXRh.js";import{N as a,s as n,M as d,g as o,b as l,c as i}from"./CjBMIK3HktuBPqZ_.js";import{r as c,X as x,s as m,S as b,p as u,l as g}from"./DuhNfJysh32dzoQX.js";import"./DRKqkMc30zo_0ikY.js";import"./CW___00ulSquyL62.js";import"./Dzd9VM057lnHWOrh.js";import"./BOmSRhSE5z7Kpxtd.js";import"./Dud8YmOKJJ5dkhIL.js";import"./BeLtu-UYPkietiDK.js";import"./LM2JspYDBI8LNjlT.js";import"./3aNFxleMQdjaFZtw.js";import"./DZoN2sFbwskeIicV.js";import"./DpIj8wd6VUmqXzzl.js";import"./rok5ZiflEFTZ0mAl.js";import"./CxGgxkmD02DlAHB9.js";import"./CdjEVO9ucAe6ofNA.js";import"./BDEOJ3om1uRt4ddv.js";const p=()=>{const p=s(),[h,f]=e.useState("popular"),[j,N]=e.useState([]),[v,y]=e.useState([]),[w,k]=e.useState("popularity"),[P,C]=e.useState([2e3,(new Date).getFullYear()]),[M,S]=e.useState(void 0),[z,F]=e.useState(!1),[R,E]=e.useState(0),[T,D]=e.useState(0),O=e.useRef(null);e.useEffect(()=>{(async()=>{try{const e=await o("movie");N(e)}catch(e){}})()},[]);const{data:A,fetchNextPage:I,hasNextPage:Q,isFetchingNextPage:G,isLoading:L,isError:W,refetch:Y}=t(["popularMovies"],async({pageParam:e=1})=>{try{const r=await l(e);return{results:r,nextPage:e+1,hasMore:20===r.length}}catch(r){throw r}},{getNextPageParam:e=>{if(e?.results&&!(e.results.length<20))return e.nextPage},enabled:"popular"===h,retry:3,onError:()=>{D(e=>e+1),T<3&&setTimeout(()=>{Y()},1e3)},staleTime:0,cacheTime:0,refetchOnMount:!0,refetchOnWindowFocus:!1}),{data:$,fetchNextPage:B,hasNextPage:_,isFetchingNextPage:q,isLoading:H,isError:J,refetch:K}=t(["filteredMovies",v,w,P,M],async({pageParam:e=1})=>{try{const r=await i(w,P,v.length>0?v:void 0,M,e);return E(r.total_results),{...r,nextPage:e+1,hasMore:e<r.total_pages}}catch(r){throw r}},{getNextPageParam:e=>{if(e)return e.hasMore?e.nextPage:void 0},enabled:"filtered"===h,retry:3,onError:()=>{T<3&&(D(e=>e+1),setTimeout(()=>{K()},1e3))},staleTime:0,cacheTime:0,refetchOnMount:!0,refetchOnWindowFocus:!1});e.useEffect(()=>{(v.length>0||"popularity"!==w||2e3!==P[0]||P[1]!==(new Date).getFullYear()||M)&&(f("filtered"),K())},[v,w,P,M,K]),e.useEffect(()=>("popular"===h?p.prefetchInfiniteQuery(["popularMovies"]):p.prefetchInfiniteQuery(["filteredMovies",v,w,P,M]),()=>{p.removeQueries(["popularMovies"]),p.removeQueries(["filteredMovies"])}),[p,h,v,w,P,M]);const U=e.useCallback(e=>{L||H||(O.current&&O.current.disconnect(),O.current=new IntersectionObserver(e=>{e[0].isIntersecting&&("popular"===h&&Q&&!G?I():"filtered"===h&&_&&!q&&B())}),e&&O.current.observe(e))},[L,H,h,Q,_,G,q,I,B]),V="popular"===h?L:H,X="popular"===h?G:q,Z="popular"===h?W:J,ee="popular"===h?A?.pages?.flatMap(e=>e.results)??[]:$?.pages?.flatMap(e=>e.results)??[],re=()=>{y([]),C([2e3,(new Date).getFullYear()]),k("popularity"),S(void 0),f("popular"),D(0),Y()},se=()=>{D(0),"popular"===h?Y():K()};return r.jsxs(r.Fragment,{children:[r.jsx(a,{}),r.jsx("div",{className:"min-h-screen pt-16 bg-background",children:r.jsxs("div",{className:"container mx-auto px-4 py-8",children:[r.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[r.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-foreground/90 flex items-center",children:[r.jsx("span",{className:"w-1 h-8 bg-brand rounded-full mr-4"}),"Movies"]}),r.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 rounded-full border transition-all duration-300 "+(z||"filtered"===h?"bg-brand/10 text-brand border-brand/50":"bg-background/80 text-foreground/80 border-border/40 hover:text-foreground"),onClick:()=>F(!z),children:[r.jsx(c,{size:18}),"Filter"]})]}),z&&r.jsxs("div",{className:"mb-6 bg-background/95 backdrop-blur-lg border border-border/40 rounded-xl overflow-hidden shadow-lg animate-in fade-in duration-300",children:[r.jsxs("div",{className:"flex justify-between items-center p-4 md:p-5 border-b border-border/40 bg-secondary/20",children:[r.jsxs("h3",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[r.jsx(c,{size:18,className:"text-brand"}),"Filter Movies"]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:re,className:"px-3 py-1.5 rounded-lg bg-background/70 hover:bg-background text-foreground/70 flex items-center gap-1.5 transition-colors text-sm",children:[r.jsx(x,{size:14}),"Clear All"]}),r.jsx("button",{onClick:()=>F(!1),className:"px-3 py-1.5 rounded-lg bg-brand/20 hover:bg-brand/30 text-brand flex items-center gap-1.5 transition-colors text-sm",children:"Apply"})]})]}),r.jsxs("div",{className:"p-4 md:p-5 space-y-6",children:[r.jsxs("div",{className:"p-4 bg-secondary/10 rounded-lg border border-border/30",children:[r.jsxs("label",{className:"block text-sm font-medium text-foreground/90 mb-3 flex items-center gap-2",children:[r.jsx(m,{size:16,className:"text-brand"}),r.jsx("span",{children:"Sort By"})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs("button",{className:"px-3 py-2 rounded-lg text-sm hover:bg-secondary/30 flex items-center gap-2 transition-all "+("popularity"===w?"bg-brand/10 border border-brand/50 text-brand shadow-sm":"bg-background/70 border border-border/40 text-foreground/80"),onClick:()=>k("popularity"),children:[r.jsx(m,{size:16}),"Popularity"]}),r.jsxs("button",{className:"px-3 py-2 rounded-lg text-sm hover:bg-secondary/30 flex items-center gap-2 transition-all "+("rating"===w?"bg-brand/10 border border-brand/50 text-brand shadow-sm":"bg-background/70 border border-border/40 text-foreground/80"),onClick:()=>k("rating"),children:[r.jsx(b,{size:16}),"Rating"]}),r.jsxs("button",{className:"px-3 py-2 rounded-lg text-sm hover:bg-secondary/30 flex items-center gap-2 transition-all "+("date"===w?"bg-brand/10 border border-brand/50 text-brand shadow-sm":"bg-background/70 border border-border/40 text-foreground/80"),onClick:()=>k("date"),children:[r.jsx(u,{size:16}),"Release Date"]})]})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{className:"p-4 bg-secondary/10 rounded-lg border border-border/30",children:[r.jsx("label",{className:"block text-sm font-medium text-foreground/90 mb-3",children:"Streaming Platforms"}),r.jsx("div",{className:"grid grid-cols-5 gap-2",children:n.map(e=>r.jsx("button",{className:"aspect-square rounded-lg hover:bg-secondary/30 flex items-center justify-center transition-all "+(M===e.id?"bg-brand/10 border border-brand/50 shadow-sm":"bg-background/50 border border-border/20"),onClick:()=>S(M===e.id?void 0:e.id),title:e.name,children:r.jsx("div",{className:"w-16 h-16 flex items-center justify-center p-1",children:r.jsx("img",{src:e.logoPath,alt:e.name,className:"w-full h-full object-contain"})})},e.id))}),M&&r.jsxs("div",{className:"mt-3 text-sm text-brand flex items-center gap-1.5",children:[r.jsx("span",{children:"Selected:"}),r.jsx("span",{className:"font-medium",children:n.find(e=>e.id===M)?.name})]})]}),r.jsxs("div",{className:"p-4 bg-secondary/10 rounded-lg border border-border/30",children:[r.jsxs("div",{className:"flex justify-between items-center mb-3",children:[r.jsx("label",{className:"block text-sm font-medium text-foreground/90",children:"Genres"}),v.length>0&&r.jsxs("button",{onClick:()=>y([]),className:"text-xs text-brand hover:text-brand/80 flex items-center gap-1",children:[r.jsx(x,{size:12}),"Clear genres"]})]}),r.jsx("div",{className:"h-[140px] overflow-y-auto pr-2 custom-scrollbar",children:r.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(e=>r.jsxs("button",{className:"px-3 py-1.5 rounded-lg text-sm hover:bg-secondary/30 flex items-center transition-all "+(v.includes(e.id)?"bg-brand/10 text-brand border border-brand/50 font-medium":"bg-background/50 text-foreground/80 border border-border/20"),onClick:()=>{return r=e.id,void y(e=>e.includes(r)?e.filter(e=>e!==r):[...e,r]);var r},children:[r.jsx("span",{children:e.name}),v.includes(e.id)&&r.jsx(x,{size:12,className:"ml-1.5"})]},e.id))})})]})]}),(v.length>0||M||"popularity"!==w)&&r.jsxs("div",{className:"mt-4 p-4 bg-brand/5 backdrop-blur-sm rounded-lg border border-brand/20",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("h4",{className:"text-sm font-medium text-brand flex items-center gap-2",children:[r.jsx(c,{size:14}),"Active Filters"]}),r.jsx("button",{onClick:re,className:"text-xs text-brand/80 hover:text-brand flex items-center gap-1",children:"Reset all"})]}),r.jsxs("div",{className:"flex flex-wrap gap-2",children:[v.length>0&&r.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-secondary/20 border border-border/40 text-xs",children:[r.jsx("span",{className:"text-foreground/80",children:"Genres:"}),r.jsxs("span",{className:"font-medium text-brand",children:[v.length," selected"]})]}),M&&r.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-secondary/20 border border-border/40 text-xs cursor-pointer hover:bg-secondary/30",onClick:()=>S(void 0),children:[r.jsx("span",{className:"text-foreground/80",children:"Platform:"}),r.jsx("span",{className:"font-medium text-brand",children:n.find(e=>e.id===M)?.name}),r.jsx(x,{size:10,className:"text-foreground/60"})]}),"popularity"!==w&&r.jsxs("div",{className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-secondary/20 border border-border/40 text-xs cursor-pointer hover:bg-secondary/30",onClick:()=>k("popularity"),children:[r.jsx("span",{className:"text-foreground/80",children:"Sort:"}),r.jsx("span",{className:"font-medium text-brand",children:"rating"===w?"Rating":"Release Date"}),r.jsx(x,{size:10,className:"text-foreground/60"})]})]})]})]})]}),r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h2",{className:"text-xl font-semibold text-foreground/90",children:"popular"===h?"Popular Movies":v.length>0?`${0===v.length?"All Genres":v.map(e=>j.find(r=>r.id===e)?.name).filter(Boolean).join(", ")}`:"Filtered Movies"}),"filtered"===h&&R>0&&r.jsxs("div",{className:"text-sm text-foreground/60",children:[R," movies found"]})]}),V?r.jsx("div",{className:"flex justify-center py-12",children:r.jsx(g,{className:"h-10 w-10 animate-spin text-brand"})}):Z?r.jsxs("div",{className:"py-16 text-center bg-background/30 rounded-xl border border-brand/5",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand/10 flex items-center justify-center",children:r.jsx(x,{className:"w-8 h-8 text-brand/40"})}),r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Something went wrong"}),r.jsx("p",{className:"text-foreground/60 mb-6 max-w-md mx-auto",children:"We couldn't load the movies. Please check your connection and try again."}),r.jsx("button",{onClick:se,className:"px-4 py-2 rounded-lg bg-brand/20 hover:bg-brand/30 text-brand flex items-center gap-2 transition-colors mx-auto",children:r.jsx("span",{children:"Retry"})})]}):ee&&ee.length>0?r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:ee.map((e,s)=>r.jsx("div",{ref:s===ee.length-1?U:void 0,children:r.jsx(d,{item:e})},`${e.id}-${s}`))}):"filtered"===h?r.jsxs("div",{className:"py-16 text-center bg-background/30 rounded-xl border border-brand/5",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand/10 flex items-center justify-center",children:r.jsx(c,{className:"w-8 h-8 text-brand/40"})}),r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No movies found"}),r.jsx("p",{className:"text-foreground/60 mb-6 max-w-md mx-auto",children:"No movies match your current filter criteria. Try adjusting your filters."}),r.jsxs("button",{onClick:re,className:"px-4 py-2 rounded-lg bg-brand/20 hover:bg-brand/30 text-brand flex items-center gap-2 transition-colors mx-auto",children:[r.jsx(x,{size:16}),"Clear Filters"]})]}):r.jsxs("div",{className:"py-16 text-center bg-background/30 rounded-xl border border-brand/5",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-brand/10 flex items-center justify-center",children:r.jsx(g,{className:"w-8 h-8 text-brand/40"})}),r.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Loading content"}),r.jsx("p",{className:"text-foreground/60 mb-6 max-w-md mx-auto",children:"Please wait while we fetch the latest movies for you."}),r.jsx("button",{onClick:se,className:"px-4 py-2 rounded-lg bg-brand/20 hover:bg-brand/30 text-brand flex items-center gap-2 transition-colors mx-auto",children:r.jsx("span",{children:"Refresh"})})]}),X&&r.jsx("div",{className:"flex justify-center py-8",children:r.jsx(g,{className:"h-8 w-8 animate-spin text-brand"})})]})})]})};export{p as default};
